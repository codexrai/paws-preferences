<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Choose your Favorite Meow! üê±</title>
<style>
body{
  margin:0;
  padding:24px 12px;
  font-family:system-ui,sans-serif;
  background:linear-gradient(180deg,#faf5ff,#f3e8ff);
  display:flex;
  justify-content:center;
}
.app{width:100%;max-width:420px}
header{display:flex;justify-content:space-between;align-items:center}
h1{margin:0;font-size:20px}
.collection-btn{
  border:0;
  background:#fff;
  padding:8px 12px;
  border-radius:999px;
  cursor:pointer;
  box-shadow:0 6px 14px #0001;
}

.deck{
  position:relative;
  width:100%;
  height:460px;
  margin:10px 0;
}

.card{
  position:absolute;
  inset:0;
  border-radius:18px;
  background:#fff;
  overflow:hidden;
  box-shadow:0 10px 22px #0002;
  touch-action:none;
  transition:transform .22s ease;
}

.card img{
  width:100%;
  height:100%;
  object-fit:cover;
}

.card:nth-child(2){transform:scale(.95) translateY(10px)}
.card:nth-child(3){transform:scale(.9) translateY(20px)}

.badge{
  position:absolute;
  top:16px;
  padding:6px 14px;
  border:3px solid;
  border-radius:10px;
  font-weight:800;
  opacity:0;
  background:#fff9;
}
.like{right:16px;color:#059669;border-color:#059669}
.nope{left:16px;color:#dc2626;border-color:#dc2626}

.controls{display:flex;gap:12px}
button{
  flex:1;
  padding:12px;
  border:0;
  border-radius:12px;
  background:#fff;
  font-size:18px;
  box-shadow:0 6px 14px #0001;
  cursor:pointer;
}
.progress{
  text-align:center;
  opacity:.7;
}

#collection{display:none}
.grid{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:10px;
  max-height:420px;
  overflow:auto;
}
.item{
  position:relative;
  border-radius:12px;
  overflow:hidden;
  box-shadow:0 8px 18px #0001;
}
.item img{
  width:100%;
  height:160px;
  object-fit:cover;
}
.remove{
  position:absolute;
  top:6px;
  right:6px;
  border:0;
  background:#fff;
  padding:4px 6px;
  border-radius:8px;
  cursor:pointer;
  box-shadow:0 4px 10px #0001;
}

.back{
  margin-top:8px;
}

.emoji{
  position:fixed;
  font-size:28px;
  animation:fall 2.5s linear forwards;
  pointer-events:none;
}
@keyframes fall{
  from{transform:translateY(-40px) scale(.4); opacity:0}
  to{transform:translateY(120vh) scale(1); opacity:1}
}
</style>
</head>
<body>

<div class="app">

<header>
<h1>Choose your Favorite Meow! üê±</h1>
<button class="collection-btn" id="open">Your cats üíû (<span id="count">0</span>)</button>
</header>

<div id="swipe">

<div class="progress" id="progress"></div>

<div class="deck" id="deck"></div>

<div class="controls">
<button id="nope">‚ùå</button>
<button id="like">ü©∑</button>
</div>

</div>

<div id="collection">
<h2>Your cats collection üíû</h2>
<div class="grid" id="grid"></div>
<button class="back" id="back">Back</button>
</div>

</div>

<script>
const TOTAL=15;
let index=0;
let history=[];
let liked=JSON.parse(localStorage.getItem("likedCats")||"[]");

const countEl=document.getElementById("count");
const cats=Array.from({length:TOTAL},(_,i)=>`https://cataas.com/cat?${Date.now()}-${i}`);

const deck=document.getElementById("deck");
const progress=document.getElementById("progress");
const grid=document.getElementById("grid");

updateCount();

function save(){
  localStorage.setItem("likedCats",JSON.stringify(liked));
}
function updateCount(){
  countEl.textContent=liked.length;
}

function makeCard(src){
  const c=document.createElement("div");
  c.className="card";

  const img=document.createElement("img");
  img.src=src;

  const l=document.createElement("div");
  l.className="badge like";
  l.textContent="LIKE";

  const n=document.createElement("div");
  n.className="badge nope";
  n.textContent="NOPE";

  c.append(img,l,n);
  return c;
}

function render(){
  deck.innerHTML="";
  cats.slice(index,index+3).reverse().forEach(src=>deck.append(makeCard(src)));
  progress.textContent=`${Math.min(index+1,TOTAL)} / ${TOTAL}`;
  drag();
}

function drag(){
  const top=deck.lastElementChild;
  if(!top) return;

  let start=0, dx=0;
  const like=top.querySelector(".like");
  const nope=top.querySelector(".nope");

  const s=e=>{
    start=(e.touches?e.touches[0]:e).clientX;
    top.style.transition="none";
  }
  const m=e=>{
    dx=(e.touches?e.touches[0]:e).clientX-start;
    const rot=dx/15;
    top.style.transform=`translateX(${dx}px) rotate(${rot}deg)`;
    like.style.opacity=dx>0?Math.min(dx/80,1):0;
    nope.style.opacity=dx<0?Math.min(-dx/80,1):0;
  }
  const e=()=>{
    top.style.transition="transform .25s";
    if(dx>120) swipe(true);
    else if(dx<-120) swipe(false);
    else top.style.transform="";
    start=0;dx=0;
  }

  top.onpointerdown=s;
  window.onpointermove=m;
  window.onpointerup=e;
}

function swipe(isLike){
  const card=deck.lastElementChild;
  card.style.transform=`translateX(${isLike?1000:-1000}px) rotate(${isLike?30:-30}deg)`;
  setTimeout(()=>{
    if(isLike){
      liked.push(cats[index]);
      save(); updateCount();
    }
    index++;
    if(index>=TOTAL){
      celebrate();
      showCollection();
    }else render();
  },200);
}

function populate(){
  grid.innerHTML='';
  liked.forEach((src,i)=>{
    const d=document.createElement("div");
    d.className="item";
    const img=document.createElement("img");
    img.src=src;
    const r=document.createElement("button");
    r.className="remove";
    r.textContent="‚ùå";
    r.onclick=()=>{
      liked.splice(i,1);
      save(); updateCount();
      populate();
    }
    d.append(img,r);
    grid.appendChild(d);
  })
}

function showCollection(){
  document.getElementById("swipe").style.display="none";
  document.getElementById("collection").style.display="block";
  populate();
}

document.getElementById("open").onclick=showCollection;
document.getElementById("back").onclick=()=>{
  document.getElementById("collection").style.display="none";
  document.getElementById("swipe").style.display="block";
};

document.getElementById("like").onclick=()=>swipe(true);
document.getElementById("nope").onclick=()=>swipe(false);

/* ---- Emoji celebration ---- */
const emojis=["ü©∑","üíñ","üíú"];
function celebrate(){
  for(let i=0;i<40;i++){
    const e=document.createElement("div");
    e.className="emoji";
    e.textContent=emojis[Math.floor(Math.random()*emojis.length)];
    e.style.left=Math.random()*100+"vw";
    e.style.animationDelay=Math.random()*0.5+"s";
    document.body.appendChild(e);
    setTimeout(()=>e.remove(),2500);
  }
}

render();
</script>

</body>
</html>
